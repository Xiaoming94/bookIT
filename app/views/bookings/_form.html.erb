<% Term.active.each_with_index do |term, i| %>
  <%= render 'term', term: term, i: i %>
<% end %>
<%= form_for(@booking, html: {class: 'page-bokning'}) do |f| %>
  <% if @booking.errors.any? %>
    <div id="error_explanation" class="message-warning">
      <h3><%= @booking.errors.count %> fel hindrade denna bokning från att sparas:</h3>

      <ul>
      <% @booking.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

 <% if @failed_bookings and @failed_bookings.any? %>
      <div id="error-repeated-bookings" class="message-warning">
        <h3><%= @failed_bookings.size %> bokningar misslyckades att sparas </h3>
        <ul>
        <% @failed_bookings.each do |fb| %>
          <ul>
          <h4><%= fb.begin_date.strftime "%F" %></h4>
          <% fb.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
          </ul>
        <% end %>
        </ul>
      </div>
    <% end %>

  <p class="title-container">
    <%= f.label :title %>
    <%= f.text_field :title, placeholder: "Ex. spelkväll med drawIT" %>
  </p>
  <p class="field">
    <%= f.label :phone %>
    <%= f.text_field :phone, data: { persist: true } %>
  </p>
  <%= f.label :room_id %>
  <ul class="location-container horizontal-list">
    <% Room.find_each do |room| %>
      <li>
        <label for="booking_room_id_<%= room.id %>">
          <%= f.radio_button :room_id, room.id, data: { fest: room.allow_party} %>
          <%= room.name %>
        </label>
      </li>
    <% end %>
  </ul>
  <ul class="booking-dates-container">
    <li>
      <%= f.label :begin_date %>
      <%= datetime_local_helper f, :begin_date %>
    </li>
    <li>
      <%= f.label :end_date %>
      <%= datetime_local_helper(f, :end_date, DateTime.now + 2.hours) %>
    </li>
  </ul>
  <p>
    <%= f.label :description %>
    <%= f.text_area :description, placeholder: "Kort beskrivning av bokningen" %>
  </p>
  <ul class="phone-and-groups-container">
    <li>
      <%= f.label :group, "Boka som" %>
      <%= f.collection_select :group, @user.groups, :to_s, :itize, include_blank: @user.full_name %>
    </li>
  </ul>
  <p class="party-container">
    <%= f.label :party do %>
      <%= f.check_box :party %> Jag vill även festanmäla
    <% end %>
  </p>
  <div class="party-info-container" style="display:none">
    <ul>
      <li>
        <%= f.label :party_responsible %>
        <%= f.text_field :party_responsible, data: { persist: true } %>
      </li>
      <li>
        <%= f.label :party_responsible_phone %>
        <%= f.text_field :party_responsible_phone, data: { persist: true } %>
      </li>
    </ul>
    <%= f.label :liquor_license do %>
      <%= f.check_box :liquor_license %> <%= Booking.human_attribute_name(:liquor_license) %>
    <% end %>
  </div>
  <div>
    <% Term.active.each_with_index do |term, i| %>
      <%= label 'term', 'accepted' do %>
        <%= check_box 'term', 'accepted', required: true %> Jag har läst igenom och accepterar <%= link_to 'bokningsvillkoren', '#', data: { 'reveal-id' => "terms_#{i}"}%>
      <% end %>
    <% end %>
    <%= label_tag :repeat_booking do %>
      <%= check_box_tag :repeat_booking %> Jag vill repetera denna bokning veckoligen
    <% end %>
    <div class="repeat-booking-container" style="display:none">
      <%= label_tag Booking.human_attribute_name(:repeat_until) %>
      <%= date_field_tag :repeat_until %>
    </div>
  </div>
  <br>
  <div class="actions">
    <%= f.submit %>
    <%= link_to "Alla bokningar", bookings_path, class: 'btn btn-boring'%>
  </div>
<% end %>
